<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poverty Prediction System</title>
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f4f7f6; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
        .form-group { display: flex; flex-direction: column; }
        label { margin-bottom: 5px; font-size: 0.9em; color: #666; }
        input { padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { grid-column: 1 / -1; margin-top: 20px; padding: 15px; background-color: #28a745; color: white; border: none; border-radius: 4px; font-size: 1.2em; cursor: pointer; }
        button:hover { background-color: #218838; }
        #mockDataBtn { background-color: #17a2b8; margin-top: 10px; }
        #mockDataBtn:hover { background-color: #138496; }
        #result { margin-top: 20px; padding: 20px; text-align: center; font-size: 1.5em; font-weight: bold; color: #007bff; border-top: 2px solid #eee; display: none; border-radius: 4px; background-color: #f0f8ff; }
        #predictBtn { display: none; }
    </style>
</head>
<body>

<div class="container">
    <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡∏à‡∏ô (Poverty Prediction)</h1>
    <p style="text-align: center;">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Feature ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô</p>
    
    <form id="predictForm">
        <div class="form-grid" id="formInputs">
            </div>
        <button type="button" id="mockDataBtn">üé≤ ‡∏™‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö (Random Mock Data)</button>
        <button type="submit" id="predictBtn">‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏ú‡∏• (Predict)</button>
    </form>

    <div id="result"></div>
</div>

<script>
    // ‡∏£‡∏±‡∏ö feature names ‡∏à‡∏≤‡∏Å Backend (‡∏ú‡πà‡∏≤‡∏ô Jinja2 template) ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏™‡πà‡πÅ‡∏ö‡∏ö Manual ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏£‡∏á‡πÜ
    // ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤ Backend ‡∏™‡πà‡∏á‡∏°‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå json ‡πÑ‡∏î‡πâ
    // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ HTML ‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô ‡∏ú‡∏°‡∏à‡∏∞‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Script ‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏≠‡πà‡∏≤‡∏ô features ‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ó‡∏µ‡πà render ‡∏°‡∏≤
    
    // ** ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ô‡∏ú‡πà‡∏≤‡∏ô Flask ‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ featuresList ‡πÄ‡∏õ‡πá‡∏ô Array ‡∏Ç‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠ column ‡πÄ‡∏≠‡∏á **
    const featuresList = {{ features | tojson }}; 

    const formContainer = document.getElementById('formInputs');
    
    // Debounce timer
    let debounceTimer = null;
    let isLoading = false;
    
    // Feature ranges for random data generation
    const featureRanges = {
        'education_level': [0, 3],           // 0-3 (categorical)
        'is_urban': [0, 1],                  // 0-1 (binary)
        'phone_technology': [0, 3],          // 0-3 (categorical)
        'can_use_internet': [0, 1],          // 0-1 (binary)
        'can_text': [0, 1],                  // 0-1 (binary)
        'num_financial_activities_last_year': [0, 10],  // 0-10 (count)
        'formal_savings': [0, 1],            // 0-1 (binary)
        'phone_ownership': [0, 2],           // 0-2 (categorical)
        'advanced_phone_use': [0, 1],        // 0-1 (binary)
        'active_bank_user': [0, 1]           // 0-1 (binary)
    };

    if (featuresList && featuresList.length > 0) {
        featuresList.forEach(feat => {
            const div = document.createElement('div');
            div.className = 'form-group';
            div.innerHTML = `
                <label for="${feat}">${feat}</label>
                <input type="number" step="any" name="${feat}" id="${feat}" placeholder="0">
            `;
            formContainer.appendChild(div);
            
            // Add real-time prediction on input change with debouncing
            const input = div.querySelector('input');
            input.addEventListener('input', function() {
                // Clear previous timer
                if (debounceTimer) {
                    clearTimeout(debounceTimer);
                }
                
                // Set new timer - only predict after 500ms of no changes
                debounceTimer = setTimeout(makePrediction, 500);
            });
        });
    } else {
        formContainer.innerHTML = '<p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ Feature ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏±‡∏ô‡∏ú‡πà‡∏≤‡∏ô Flask Server</p>';
    }

    // Mock Data Button Handler
    document.getElementById('mockDataBtn').addEventListener('click', async function() {
        featuresList.forEach(feat => {
            const input = document.getElementById(feat);
            if (input && featureRanges[feat]) {
                const [min, max] = featureRanges[feat];
                // Generate random value within range
                const randomValue = Math.random() * (max - min) + min;
                // Round to integers for all features since they're all categorical or binary
                input.value = Math.round(randomValue);
            }
        });
        
        // Auto-predict after generating mock data
        await makePrediction();
    });

    async function makePrediction() {
        // Prevent multiple simultaneous requests
        if (isLoading) return;
        
        const data = {};
        featuresList.forEach(feat => {
            const input = document.getElementById(feat);
            if (input) {
                data[feat] = input.value;
            }
        });

        const resultDiv = document.getElementById('result');
        isLoading = true;
        resultDiv.style.display = 'block';
        resultDiv.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...';

        try {
            const response = await fetch('/predict', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            const result = await response.json();
            
            if (result.poverty_probability !== undefined) {
                const prob = result.poverty_probability.toFixed(2);
                resultDiv.innerHTML = `‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏¢‡∏≤‡∏Å‡∏à‡∏ô: <span style="color:red">${prob}%</span>`;
            } else {
                resultDiv.innerText = 'Error: ' + (result.error || 'Unknown error');
            }
        } catch (err) {
            resultDiv.innerText = 'Error connecting to server';
        } finally {
            isLoading = false;
        }
    }

    document.getElementById('predictForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        await makePrediction();
    });
</script>

</body>
</html>